#! /bin/bash
printf "*************SHELL: $SHELL*************\n"
#global variables
filePath=tempFile$$
numRows=0
numCols=0


# validateMatrix()
# parameter(s): File containing matrix to be verified
# function: Check matrix to assure requirements:
#   1. File is readable
#   2. Tab-delimited table
#   3. Must contain at least one element
#   4. Each element must be a signed int and defined
#   5. Table must be rectangular
#   6. Must not allow:
#           - empty matrix
#           - matrix where final entry on a row is a tab character
#           - matrix with empty lines
#           - matrix with any element that is blank or not an int
# output: If matrix is valid, there is no output and the program will resume with
#         executing the user command. 
#         If matrix is invalid then:
#                   - output an error message to stderr
#                   - return value should be non-zero
validateMatrix(){
    printf "validating matrix\n"
}

# dims()
# parameter(s): A matrix of integers which can be contained in a file or entered via stdin    
# function: Calculates the dimensions of the matrix
# output: Number of rows and the number of columns separated by a single space to stdout 
#         and return 0
# error handling: Print error message to stderr and return/exit 1
#       In the event that:
#           - argument count is  > 1
#           - file containing matrix cannot be read
dims(){
    #variable to store column count
    colCnt=0
    #read each line from  file or stdin into numLine
    while read numLine
        do
        #for each value read from numLine
        for i in $numLine
            do
            #increment colCnt by 1
            colCnt=$(expr $colCnt + 1)
        done
        #if global variable numCols has not been set yet
        if [ $numCols -eq 0 ]
            then
            #set numCols to initial colCnt
            numCols=$colCnt
        #else if colCnt is not equal to numCols
        elif [ $colCnt -ne $numCols ]
            then
            #print error message and exit
            printf "Error - invalid matrix\n"
            exit 1
        fi
        #reset colCnt for next line 
        colCnt=0
        #incmrenent global variable numRows
        numRows=$(expr $numRows + 1)
    #read commant will read from file provided via argument 1 
    #or via data being passed in from stdin
    done <${1:-/dev/stdin}
    #output of the results of the dimensions of the matrix
    printf "$numRows $numCols\n"
    return 0
}

# transpose()
# parameter(s): A matrix of integers which can be contained in a file or entered via stdin
# function: Relects matrix along the main diagnol. MxN => NxM
# output: Output the new matrix to stdout and return 0
# error handling: Print error message to stderr and return/exit 1
#       In the event that:
#           - argument count is  > 1
#           - file containing matrix cannot be read
transpose(){
    #temp files to store data
    tempCol=tempColFile$$
    tempRow=tempRowFile$$
    tempOutput=tempOutputFile$$
    #variable to keep count of the column to be cut
    colCnt=0

    #call dims to find number of columns for matrix
    dims $1 1>/dev/null #redirect output from stdout to /dev/null

    while [ $colCnt -ne $numCols ]
        do
        #increment colCnt
        colCnt=$(expr $colCnt + 1)
        #cut colCnt'th field
        cut -f $colCnt $1 > $tempCol
        #transform newline chars to tabs 
        cat $tempCol | tr '\n' '\t' > $tempRow
        temp=$(cat $tempRow)
        #removes trailing tab char
        temp=${temp::-1}
        #append row to output file
        echo "$temp" >> $tempOutput
    done

    #output transposed matrix to stdout
    cat $tempOutput
    #remove temp files
    rm -f $tempCol
    rm -f $tempRow
    rm -f $tempOutput
}

# mean() 
# parameter(s): A matrix of integers which can be contained in a file or entered via stdin
# function: Calculates the mean of the values for each column in the matrix
# output: Output the mean values for each row to stdout and return 0
# error handling: Print error message to stderr and return/exit 1
#       In the event that:
#           - argument count is  > 1
#           - file containing matrix cannot be read
mean(){
    #temp files to store data
    tempInput=tempInputFile$$
    tempOutput=tempOutputFile$$
    #variables
    numCnt=0 #count of the the numbers being added
    numSum=0 #sum of values being added
    meanVal=0 #mean value of the numbers being added

    ## using transpose to convert columns into rows so that I can use ##
    ## a while loop to read each line(row) and calculate the mean     ##

    #call transpose and redirect output to a tempFile
    transpose $1 | cat >$tempInput
    cat $tempInput

    #read row of numbers from file into variable numLine
    while read numLine
        do
        #for each value in numLine
        for numVal in $numLine
            do
            #increment numCnt
            numCnt=$(expr $numCnt + 1)
            #added value in i to numSum
            numSum=$(expr $numSum + $numVal)
        done
        #find mean
        echo -e "numCnt: $numCnt\tnumSum: $numSum"
        #append mean value to tempOutput

        #zero out variables before beginning next iteration
        numCnt=0
        numSum=0
        meanVal=0
    done <$tempInput

    #remove tempFiles
    rm -f $tempInput
    rm -f $tempOutput
}

# add()
# parameter(s): Two matrices contained within files   
# function: Adds the two matrices element wise to produce another matrix
# output: Output the new matrix containing all the sum values to stdout 
#         and return 0
# error handling: Print error message to stderr and return/exit 1
#       In the event that:
#           - argument count is != 2
#           - either file containing a matrix cannot be read
#           - the dimensions of the input matrices do not allow them to be 
#             added together following the rules of matrix addition
add(){
    printf "add called with arg1: $1, arg2: $2\n"
}

# multiply() operation call - 
# parameter(s):    
# function: 
# output: 
# error handling: Print error message to stderr and return/exit 1
#       In the event that:
#           - argument count is != 2
#           - either file containing a matrix cannot be read
#           - the dimensions of the input matrices do not allow them to be 
#             multiplied together following the rules of matrix multiplication
multiply(){
    printf "add called with arg1: $1, arg2: $2\n"
}

###########################################################################
# 
#
#
#
###########################################################################

echo -e "arg1: $1\targ2: $2\targ3: $3\t argc: $#"
#operation == dims or transpose or mean
if [ $1 = "dims" ] || [ $1 = "transpose" ] || [ $1 = "mean" ]
    then
    #if user tries to pass more than two args to the above three operations
    if [ $# -gt 2 ]
        #handle error
        then
        #error message redirected from stdout to stderr
        echo -e "Error executing $1 - invalid number of arguments" 
        exit 1
    #three args total ($2 contains file name to be passed to operation) 
    elif [ $# = 2 ]
        then
        $1 $2
    #two args total => means no file name passed => which means read from stdin
    else
        cat > $filePath
        $1 tempFile$$
        rm -f tempFile$$
    fi
fi

#$1 ${@:2}

